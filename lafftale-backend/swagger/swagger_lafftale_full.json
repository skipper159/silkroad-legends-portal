{
  "openapi": "3.0.0",
  "info": {
    "title": "Lafftale Web API",
    "version": "1.0.0",
    "description": "REST API for user management, support ticketing, and donation/voting in the Silkroad Lafftale website"
  },
  "servers": [
    {
      "url": "http://localhost:3000/api"
    }
  ],
  "paths": {
    "/api/auth/register": {
      "post": {
        "summary": "Register a new user",
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "username": { "type": "string" },
                  "email": { "type": "string" },
                  "password": { "type": "string" }
                },
                "required": ["username", "email", "password"]
              }
            }
          }
        },
        "responses": {
          "201": { "description": "User registered" },
          "400": { "description": "Missing fields" },
          "500": { "description": "Database error" }
        }
      }
    },
    "/api/auth/login": {
      "post": {
        "summary": "Login a user",
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "username": { "type": "string" },
                  "password": { "type": "string" }
                },
                "required": ["username", "password"]
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "JWT token returned",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "token": { "type": "string" }
                  }
                }
              }
            }
          },
          "403": { "description": "Invalid credentials" },
          "500": { "description": "Login error" }
        }
      }
    },
    "/api/users/me": {
      "get": {
        "summary": "Get authenticated user's profile",
        "security": [ { "bearerAuth": [] } ],
        "responses": {
          "200": {
            "description": "User profile",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "Id": { "type": "integer" },
                    "Username": { "type": "string" },
                    "Email": { "type": "string" },
                    "RegisteredAt": { "type": "string" },
                    "LastLogin": { "type": "string" }
                  }
                }
              }
            }
          },
          "401": { "description": "Unauthorized" }
        }
      }
    },
    "/api/tickets": {
      "post": {
        "summary": "Create a new support ticket",
        "security": [ { "bearerAuth": [] } ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "subject": { "type": "string" },
                  "message": { "type": "string" },
                  "priority": { "type": "string", "enum": ["low", "normal", "high"] }
                },
                "required": ["subject", "message"]
              }
            }
          }
        },
        "responses": {
          "201": { "description": "Ticket created" },
          "400": { "description": "Missing fields" },
          "500": { "description": "Error creating ticket" }
        }
      }
    },
    "/api/tickets/my": {
      "get": {
        "summary": "Get the authenticated user's tickets",
        "security": [ { "bearerAuth": [] } ],
        "responses": {
          "200": {
            "description": "List of tickets",
            "content": {
              "application/json": {
                "schema": { "type": "array", "items": { "type": "object" } }
              }
            }
          },
          "401": { "description": "Unauthorized" }
        }
      }
    },
    "/api/tickets/{id}": {
      "get": {
        "summary": "Get a ticket and its messages",
        "security": [ { "bearerAuth": [] } ],
        "parameters": [
          { "name": "id", "in": "path", "required": true, "schema": { "type": "integer" } }
        ],
        "responses": {
          "200": { "description": "Ticket and messages" },
          "404": { "description": "Ticket not found" },
          "500": { "description": "Error loading ticket" }
        }
      }
    },
    "/api/tickets/{id}/message": {
      "post": {
        "summary": "Add a message to a ticket",
        "security": [ { "bearerAuth": [] } ],
        "parameters": [
          { "name": "id", "in": "path", "required": true, "schema": { "type": "integer" } }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": { "message": { "type": "string" } },
                "required": ["message"]
              }
            }
          }
        },
        "responses": {
          "200": { "description": "Message added" },
          "400": { "description": "Message required" },
          "500": { "description": "Error adding message" }
        }
      }
    },
    "/api/admin/tickets/open": {
      "get": {
        "summary": "Get all open tickets (Admin only)",
        "security": [ { "bearerAuth": [] } ],
        "responses": {
          "200": { "description": "List of open tickets" },
          "403": { "description": "Access denied" },
          "500": { "description": "Error loading open tickets" }
        }
      }
    },
    "/api/admin/tickets/{id}/close": {
      "put": {
        "summary": "Close a ticket (Admin only)",
        "security": [ { "bearerAuth": [] } ],
        "parameters": [
          { "name": "id", "in": "path", "required": true, "schema": { "type": "integer" } }
        ],
        "responses": {
          "200": { "description": "Ticket closed" },
          "403": { "description": "Access denied" },
          "500": { "description": "Error closing ticket" }
        }
      }
    },
    "/api/donation/initiate": {
      "post": {
        "summary": "Initiate a donation",
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "userId": { "type": "integer" },
                  "amount": { "type": "number" },
                  "silkAmount": { "type": "integer" },
                  "method": { "type": "string" }
                },
                "required": ["userId", "amount", "silkAmount", "method"]
              }
            }
          }
        },
        "responses": {
          "200": { "description": "Donation initiated" }
        }
      }
    },
    "/api/donation/wallet/{userId}": {
      "get": {
        "summary": "Get wallet silk balance",
        "parameters": [
          {
            "name": "userId",
            "in": "path",
            "required": true,
            "schema": { "type": "integer" }
          }
        ],
        "responses": {
          "200": { "description": "Silk balance returned" },
          "404": { "description": "User not found" }
        }
      }
    },
    "/api/donation/vote/{platform}": {
      "post": {
        "summary": "Vote for Silk and register reward",
        "parameters": [
          {
            "name": "platform",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string",
              "enum": ["xtreme", "arena", "gtop", "topg"]
            }
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "userId": { "type": "integer" }
                },
                "required": ["userId"]
              }
            }
          }
        },
        "responses": {
          "200": { "description": "Vote registered and silk added" },
          "400": { "description": "Invalid voting platform" }
        }
      }
    },
    "/api/ranking/{type}": {
      "get": {
        "summary": "Get paginated rankings by type",
        "parameters": [
          {
            "name": "type",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string",
              "enum": ["top-player", "top-guild", "unique", "thief", "trader", "hunter"]
            },
            "description": "Ranking type to fetch"
          },
          {
            "name": "page",
            "in": "query",
            "required": false,
            "schema": {
              "type": "integer",
              "default": 1
            },
            "description": "Page number"
          }
        ],
        "responses": {
          "200": {
            "description": "List of ranked entries",
            "content": {
              "application/json": {
                "schema": {
                  "type": "array",
                  "items": { "type": "object" }
                }
              }
            }
          },
          "400": { "description": "Invalid ranking type" },
          "500": { "description": "Database error" }
        }
      }
    },
    "/api/characters/gameaccounts": {
      "post": {
        "summary": "Create a new game account",
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "username": { "type": "string" },
                  "password": { "type": "string" },
                  "webUserId": { "type": "integer" }
                },
                "required": ["username", "password", "webUserId"]
              }
            }
          }
        },
        "responses": {
          "201": { "description": "Game account created" },
          "400": { "description": "Missing fields" },
          "500": { "description": "Failed to create game account" }
        }
      }
    },
    "/api/characters/gameaccounts/{id}/password": {
      "put": {
        "summary": "Change game account password",
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "required": true,
            "schema": { "type": "integer" }
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "newPassword": { "type": "string" }
                },
                "required": ["newPassword"]
              }
            }
          }
        },
        "responses": {
          "200": { "description": "Password updated" },
          "400": { "description": "New password required" },
          "500": { "description": "Failed to update password" }
        }
      }
    },
    "/api/characters/gameaccounts/{id}": {
      "delete": {
        "summary": "Delete a game account",
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "required": true,
            "schema": { "type": "integer" }
          }
        ],
        "responses": {
          "200": { "description": "Game account deleted" },
          "500": { "description": "Failed to delete game account" }
        }
      }
    },
    "/api/characters/{charId}/details": {
      "get": {
        "summary": "Get detailed character information including equipped items",
        "parameters": [
          {
            "name": "charId",
            "in": "path",
            "required": true,
            "schema": {
              "type": "integer"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Character details returned",
            "content": {
              "application/json": {
                "schema": {
                  "type": "array",
                  "items": {
                    "type": "object",
                    "properties": {
                      "CharID": { "type": "integer" },
                      "CharName16": { "type": "string" },
                      "Level": { "type": "integer" },
                      "Strength": { "type": "integer" },
                      "Intellect": { "type": "integer" },
                      "Slot": { "type": "integer" },
                      "RefItemID": { "type": "integer" },
                      "CodeName128": { "type": "string" },
                      "Name128": { "type": "string" },
                      "Desc128": { "type": "string" }
                    }
                  }
                }
              }
            }
          },
          "500": { "description": "Failed to load character details" }
        }
      }
    },
    "/api/silk/balance/{gameAccountId}": {
      "get": {
        "summary": "Get Silk balance for a game account",
        "parameters": [
          {
            "name": "gameAccountId",
            "in": "path",
            "required": true,
            "schema": { "type": "integer" }
          }
        ],
        "responses": {
          "200": {
            "description": "Current Silk amount",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "silk": { "type": "integer" }
                  }
                }
              }
            }
          },
          "404": { "description": "Game account not found" },
          "500": { "description": "Failed to fetch Silk balance" }
        }
      }
    },
    "/api/silk/add": {
      "post": {
        "summary": "Add Silk to a game account",
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "gameAccountId": { "type": "integer" },
                  "amount": { "type": "integer" }
                },
                "required": ["gameAccountId", "amount"]
              }
            }
          }
        },
        "responses": {
          "200": { "description": "Silk added successfully" },
          "400": { "description": "Missing fields" },
          "500": { "description": "Failed to add Silk" }
        }
      }
    },
    "/api/silk/spend": {
      "post": {
        "summary": "Spend Silk from a game account",
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "gameAccountId": { "type": "integer" },
                  "amount": { "type": "integer" }
                },
                "required": ["gameAccountId", "amount"]
              }
            }
          }
        },
        "responses": {
          "200": { "description": "Silk spent successfully" },
          "400": { "description": "Not enough Silk or missing fields" },
          "500": { "description": "Failed to spend Silk" }
        }
      }
    }
  },
  "components": {
    "securitySchemes": {
      "bearerAuth": {
        "type": "http",
        "scheme": "bearer",
        "bearerFormat": "JWT"
      }
    }
  }
}
